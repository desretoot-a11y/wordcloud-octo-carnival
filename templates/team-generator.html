// Список участников Сбербанка
const participants = [
    "Эги Андрей",
    "Цыбенко Елена",
    "Куликов Алексей",
    "Андрианова Яна",
    "Бакотин Илья",
    "Куличенко Елизавета",
    "Захаров Георгий",
    "Шукан Николай",
    "Михайленко Алексей",
    "Абрамчук Илья",
    "Панарин Сергей",
    "Чумаков Александр",
    "Болдырева Анна",
    "Данилов Антон",
    "Пудовкин Максим",
    "Гирш Антон",
    "Zаярский Иван",
    "Третьяков Максим",
    "Абрамов Дмитрий",
    "Загидулин Александр",
    "Корсакова Елена",
    "Поташева Надежда",
    "Сайдуллин Данил"
];

// Предопределённые команды по новому приказу
const predefinedTeams = [
    ["Эги Андрей", "Цыбенко Елена", "Куликов Алексей", "Андрианова Яна"],
    ["Бакотин Илья", "Куличенко Елизавета", "Захаров Георгий", "Шукан Николай"],
    ["Михайленко Алексей", "Абрамчук Илья", "Панарин Сергей", "Чумаков Александр"],
    ["Болдырева Анна", "Данилов Антон", "Пудовкин Максим", "Гирш Антон"],
    ["Zаярский Иван", "Третьяков Максим", "Абрамов Дмитрий", "Загидулин Александр"],
    ["Корсакова Елена", "Поташева Надежда", "Сайдуллин Данил"]
];

let selectedPeople = [...participants];

// Инициализация списка участников
function initPeopleList() {
    const grid = document.getElementById('peopleGrid');
    grid.innerHTML = '';
    
    participants.forEach(person => {
        const card = document.createElement('div');
        card.className = 'person-card selected';
        card.textContent = person;
        card.onclick = () => togglePersonSelection(person, card);
        grid.appendChild(card);
    });
    
    updateStats();
}

// Выбор/отмена выбора участника
function togglePersonSelection(person, card) {
    const index = selectedPeople.indexOf(person);
    if (index > -1) {
        selectedPeople.splice(index, 1);
        card.classList.remove('selected');
    } else {
        selectedPeople.push(person);
        card.classList.add('selected');
    }
    updateStats();
}

// Обновление статистики
function updateStats() {
    document.getElementById('totalPeople').textContent = participants.length;
    document.getElementById('selectedPeople').textContent = selectedPeople.length;
    document.getElementById('teamCountDisplay').textContent = document.getElementById('teamCount').value;
}

// Генерация команд по предопределённому списку
function generateTeams() {
    const teamCount = parseInt(document.getElementById('teamCount').value);
    const maxTeamSize = parseInt(document.getElementById('maxTeamSize').value);
    
    if (selectedPeople.length === 0) {
        alert('Выберите хотя бы одного участника!');
        return;
    }
    
    // Показываем загрузку
    document.getElementById('loading').style.display = 'block';
    document.getElementById('teamsContainer').style.display = 'none';
    document.getElementById('generateBtn').disabled = true;
    
    // Имитация анимации распределения
    setTimeout(() => {
        distributePredefinedTeams();
        document.getElementById('loading').style.display = 'none';
        document.getElementById('teamsContainer').style.display = 'block';
        document.getElementById('generateBtn').disabled = false;
        
        // Прокручиваем к результатам
        document.getElementById('teamsContainer').scrollIntoView({ behavior: 'smooth' });
    }, 2500);
}

// Распределение по предопределённым командам
function distributePredefinedTeams() {
    // Фильтруем предопределённые команды, оставляя только участников из selectedPeople
    const filteredTeams = predefinedTeams.map(team => 
        team.filter(member => selectedPeople.includes(member))
    ).filter(team => team.length > 0); // Убираем пустые команды
    
    // Отображаем команды
    displayTeams(filteredTeams);
}

// Отображение команд
function displayTeams(teams) {
    const grid = document.getElementById('teamsGrid');
    grid.innerHTML = '';
    
    teams.forEach((team, index) => {
        if (team.length === 0) return; // Пропускаем пустые команды
        
        const teamCard = document.createElement('div');
        teamCard.className = 'team-card';
        
        const teamHeader = document.createElement('div');
        teamHeader.className = 'team-header';
        teamHeader.innerHTML = `
            <h3>Команда ${String(index + 1).padStart(2, '0')}</h3>
            <p>${team.length} ${getWordForm(team.length, ['участник', 'участника', 'участников'])}</p>
        `;
        
        const teamMembers = document.createElement('div');
        teamMembers.className = 'team-members';
        
        team.forEach((member, memberIndex) => {
            const memberDiv = document.createElement('div');
            memberDiv.className = 'team-member';
            memberDiv.innerHTML = `
                <div style="font-size: 0.9rem; opacity: 0.9;">#${memberIndex + 1}</div>
                <div style="font-weight: 600;">${member}</div>
            `;
            teamMembers.appendChild(memberDiv);
        });
        
        teamCard.appendChild(teamHeader);
        teamCard.appendChild(teamMembers);
        grid.appendChild(teamCard);
    });
}

// Правильное склонение слов
function getWordForm(number, forms) {
    const cases = [2, 0, 1, 1, 1, 2];
    return forms[(number % 100 > 4 && number % 100 < 20) ? 2 : cases[Math.min(number % 10, 5)]];
}

// Сброс
function reset() {
    selectedPeople = [...participants];
    initPeopleList();
    document.getElementById('teamsContainer').style.display = 'none';
    document.getElementById('teamCount').value = 4;
    document.getElementById('maxTeamSize').value = 5;
}

// Инициализация
document.addEventListener('DOMContentLoaded', function() {
    initPeopleList();
    
    document.getElementById('generateBtn').onclick = generateTeams;
    document.getElementById('resetBtn').onclick = reset;
    
    // Обновление статистики при изменении параметров
    document.getElementById('teamCount').addEventListener('input', updateStats);
    document.getElementById('maxTeamSize').addEventListener('input', updateStats);
});
